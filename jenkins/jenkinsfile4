pipeline {
    agent any

    environment {
        DOCKER_IMAGE = "vishwas8535/myapp:latest"
    }

    stages {
        stage('Pull Docker Image') {
            steps {
                script {
                    echo "Pulling Docker image: ${DOCKER_IMAGE}"
                    sh "docker pull ${DOCKER_IMAGE}"
                }
            }
        }

        stage('Run Docker Container') {
            steps {
                script {
                    echo "Running Docker container..."
                    sh "docker run --rm ${DOCKER_IMAGE} echo 'Container started successfully!'"
                }
            }
        }

        

       stage('Run Container in Background') {
            steps {
                script {
                    echo "Starting container in detached mode..."
                    // Stop and remove old container if it exists
                    sh "docker stop my_app_container || true"
                    sh "docker rm my_app_container || true"
                    // Run fresh container
                    sh "docker run -d -p 9090:8080 --name my_app_container ${DOCKER_IMAGE}"
                }
            }
        }


        
        stage('Cleanup') {
            steps {
                script {
                    echo "Stopping and removing container..."
                    sh "docker stop my_app_container || true"
                    sh "docker rm my_app_container || true"
                }
            }
        }
    }
}
