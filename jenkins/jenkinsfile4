pipeline {
    agent Slave1

    environment {
        DOCKER_IMAGE = "vishwas8535/myapp:latest"
    }

    stages {
        stage('Pull Docker Image') {
            steps {
                script {
                    echo "Pulling Docker image: ${DOCKER_IMAGE}"
                    sh "docker pull ${DOCKER_IMAGE}"
                }
            }
        }

        stage('Run Docker Container') {
            steps {
                script {
                    echo "Running Docker container..."
                    // Run container and execute a command inside (e.g., run app)
                    sh "docker run --rm ${DOCKER_IMAGE} echo 'Container started successfully!'"
                }
            }
        }

        stage('Run Container in Background') {
            steps {
                script {
                    echo "Starting container in detached mode..."
                    // Example: start in detached mode and expose a port
                    sh "docker run -d -p 8080:8080 --name my_app_container ${DOCKER_IMAGE}"
                }
            }
        }

        stage('Cleanup') {
            steps {
                script {
                    echo "Stopping and removing container..."
                    sh "docker stop my_app_container || true"
                    sh "docker rm my_app_container || true"
                }
            }
        }
    }
}
